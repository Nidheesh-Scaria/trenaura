
<head>
    
    <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
    <style>
            
    .orders-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    
    }

    .orders-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
    }

    .actions {
    display: flex;
    gap: 10px;
    }

    .actions input {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    }

    .actions .btn {
    background: #f0f0f0;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    }

    .actions .btn.export {
    background: #003cff;
    color: white;
    }

    /* ================================
    TABLE STYLES
    ================================ */
    .orders-table {
    width: 100%;
    border-collapse: collapse;
    }

    .orders-table thead tr {
    background: #eceaea;
    color: #181717;
    text-align: left;
    }

    .orders-table th,
    .orders-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    }

    /* ================================
    ORDER ITEMS
    ================================ */
    .order-items {
    display: flex;
    flex-direction: column;
    gap: 8px;
    }

    .order-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    color: #333;
    }

    .order-img {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #ddd;
    }

    .order-item .qty {
    color: #888;
    font-size: 13px;
    }

    /* ================================
    STATUS BADGES
    ================================ */
    .status {
    padding: 5px 10px;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: bold;
    display: inline-block;
    text-align: center;
    min-width: 100px;
    }

    /* return Status */
    .status-pending {
    background: #f0ad4e;
    color: #fff;
    }

    .status-accepted {
    background: #0275d8;
    color: #fff;
    }

    .status-rejected {
    background: #f81e1e;
    color: #fff;
    }


    
    /* ============================
   REFUND STATUS STYLES
   ============================ */

    
    .refund-status {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-align: center;
        min-width: 90px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Paid - green */
    .refund-paid {
        background-color: #28a745;
        color: #fff;
        border: 1px solid #1e7e34;
    }



    /* Unpaid - red */
    .refund-unpaid {
        background-color: #e00d22;
        color: #fff;
        border: 1px solid #bd2130;
    }

    /* Pending - yellow/orange */
    .refund-pending {
        background-color: #ffc107;
        color: #212529;
        border: 1px solid #e0a800;
    }


    /* ================================
    BUTTONS
    ================================ */
    .action-btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            margin: 0 4px;
            transition: 0.3s;
        }
    .btn-approve {
            background: #28a745;
            color: #fff;
        }

        .btn-reject {
            background: #dc3545;
            color: #fff;
        }

        .btn-view {
            background: #007bff;
            color: #fff;
        }

        .btn-approve:hover {
            background: #218838;
        }

        .btn-reject:hover {
            background: #c82333;
        }

        .btn-view:hover {
            background: #0069d9;
        }

    /* ================================
    PAGINATION
    ================================ */



        .pagination {
        display: flex;
        justify-content: center;
        gap: 6px;
        margin-top: 20px;
        }

        .page-btn,
        .page-number {
        display: inline-block;
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        color: #333;
        text-decoration: none;
        cursor: pointer;
        transition: 0.2s;
        }

        .page-btn:hover,
        .page-number:hover {
        background: #f0f0f0;
        }

        .page-number.current {
        background: #007bff;
        color: white;
        border-color: #007bff;
        font-weight: bold;
        }

        .page-btn[disabled] {
        opacity: 0.5;
        cursor: not-allowed;
        }

       

    </style>
</head>


<main class="main-content">
    <div class="orders-header">
        <h2>Orders</h2>
        <div class="actions">
            <form action="/admin/order" method="GET">
                <input type="text" name="search" placeholder="ðŸ” Search here" value="{{search}}">
            </form>
            {{!-- <button class="btn export"><i class="fas fa-download"></i> Export</button>
            <button class="btn"><i class="fas fa-sort"></i> Sort By</button>
            <button class="btn"><i class="fas fa-filter"></i> Filters</button> --}}
        </div>
    </div>

    <table class="orders-table">
        
        <thead>
            <tr>
                <th>Product</th>
                <th>Customer</th>
                <th>Date</th>
                <th>Return Status</th>
                <th>Refund Status</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            {{#each orders}}
             {{#each this.orderedItems}}
            <tr>
                <td>
                    <img src="/images/{{this.productImages.[1]}}" alt="Product" class="order-img">
                    <span>{{this.productName}}</span>
                    <span class="qty">(x{{this.quantity}})</span>
                </td>
                <td>{{../user.name}} </td>
                <td>{{this.returnDate}}</td>

                {{!-- return approved status --}}
                {{#if (eq this.isAdminApproved true)}}
                <td><span class="status status-accepted">Approved</span></td>
                {{else if (eq this.isAdminApproved null)}}
                <td><span class="status status-pending">Pending</span></td>
                {{else}}
                <td><span class="status status-rejected">Rejected</span></td>
                {{/if}}
                
                {{!-- refund status --}}
                {{#if (eq this.refundStatus true)}}
                <td><span class="refund-status refund-paid">Paid</span></td>
                {{else if (eq this.refundStatus false)}}
                <td><span class="refund-status refund-unpaid">Unpaid</span></td>
                {{else}}
                <td><span class="refund-status refund-pending">Pending</span></td>
                {{/if}}
               
                <td>
                    <button class="action-btn btn-view btn-View" onclick="viewReturn(event,'{{this.id}}')">View</button>
                    {{!-- <button class="action-btn btn-approve btn-approve" onclick="acceptReturn(event,'{{this.id}}')">Approve</button>
                    <button class="action-btn btn-reject btn-reject" onclick="rejectReturn(event,'{{this.id}}')">Reject</button> --}}
                </td>
                </td>
            </tr>
            {{/each}}
            {{/each}}

        </tbody>



    </table>

    {{!-- Pagination --}}

    <div class="pagination">
        {{!-- Previous --}}
        {{#ifCond currentPage ">" 1}}
        <a href="?page={{decrement currentPage}}" class="page-btn">&lt;</a>
        {{else}}
        <button class="page-btn" disabled>&lt;</button>
        {{/ifCond}}

        {{!-- Page Numbers --}}
        {{#each (range 1 totalPage)}}
        {{#ifCond this "===" ../currentPage}}
        <span class="page-number current">{{this}}</span>
        {{else}}
        <a href="?page={{this}}" class="page-number">{{this}}</a>
        {{/ifCond}}
        {{/each}}

        {{!-- Next --}}
        {{#ifCond currentPage "<" totalPage}} <a href="?page={{increment currentPage}}" class="page-btn">&gt; </a>
            {{else}}
            <button class="page-btn" disabled>&gt;</button>
            {{/ifCond}}
    </div>


</main>




</div>




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script>
    function viewReturn(event,id){
        console.log(id)
        event.preventDefault();
         try {
        window.location.href = `/admin/reviewReturn/${id}`;
        } catch (error) {
            console.error("Error navigating to order management:", error);
        }
    }


async function acceptReturn(event, id) {
        event.preventDefault();
        console.log("acceptReturn id:", id);

        try {
            const isAccepted = true;

            const res = await fetch(`/admin/changeReturnStatus/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ isAccepted })
            });

            const data = await res.json();

            if (res.ok) {
               Toastify({
                text: data.message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                style: {
                background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)",
                },
                className: "custom-toast"
            }).showToast();
                
            } else {
                Toastify({
                text: data.message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                style: {
                background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)",
                },
                className: "custom-toast"
            }).showToast();
            }

        } catch (error) {
            console.error("Error accepting return:", error);
            Swal.fire({
                icon: "error",
                title: "Oops!",
                text: "Server error. Please try again later."
            });
        }
    }

    async function rejectReturn(event,id){
        event.preventDefault();
        console.log("acceptReturn id:", id);

        try {
            const isRejected=true
            const res = await fetch(`/admin/changeReturnStatus/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ isRejected })
            });

            const data = await res.json();

            if (res.ok) {
               Toastify({
                text: data.message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                style: {
                background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)",
                },
                className: "custom-toast"
            }).showToast();
                
            } else {
                Toastify({
                text: data.message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                style: {
                background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)",
                },
                className: "custom-toast"
            }).showToast();
            }

        } catch (error) {
            console.error("Error accepting return:", error);
            Swal.fire({
                icon: "error",
                title: "Oops!",
                text: "Server error. Please try again later."
            });
        }
    }
       
       
       
</script>