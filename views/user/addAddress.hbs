
  {{!-- <head>
    
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        width: 100%;
      }

      .address-container {
        background: #fff;
        width: 600px;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h3 {
        text-align: center;
        margin-bottom: 20px;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      input,
      textarea,
      select {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
        width: 100%;
        box-sizing: border-box;
      }

      textarea {
        resize: none;
      }

      .radio-group {
        display: flex;
        gap: 20px;
      }

      .radio-group label {
        font-size: 14px;
      }

      .actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .actions button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }

      .actions .save {
        background-color: #007bff;
        color: white;
      }

      .actions .cancel {
        background-color: #ccc;
        color: black;
      }

      #addressError {
        color: red;
        text-align: center;
      }
    </style>
  </head> --}}
  <head>
    <style>
      
      
/* General Reset and Body Styling */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif; /* A modern, clean font */
}

/* Fallback for the custom font, if needed */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

:root {
    --primary-color: #0d0d0d; /* Dark text/backgrounds */
    --secondary-color: #ffffff; /* White backgrounds */
    --accent-color: #FFC300; /* Sophisticated Gold/Yellow for 'Glow' */
    --light-gray: #f4f4f4; /* Light background for sections */
    --border-color: #ccc;
    --error-color: #ff4d4f;
}

body {
    background-color: var(--secondary-color);
    color: var(--primary-color);
    line-height: 1.6;
}


/* ------------------------------------------- */
/* MAIN CONTENT (ADDRESS) STYLES      */
/* ------------------------------------------- */

main {
    padding: 50px 20px;
    background-color: var(--light-gray);
    min-height: 80vh;
}

.address-container {
    max-width: 700px;
    margin: 0 auto;
    background-color: var(--secondary-color);
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.address-container h3 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--primary-color);
    border-bottom: 2px solid var(--accent-color);
    display: inline-block;
    padding-bottom: 5px;
    width: auto;
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
    display: block; /* To center the inline-block element */
}

/* Form Layout */
.row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.row input,
.address-container textarea {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1rem;
    color: var(--primary-color);
    transition: border-color 0.3s, box-shadow 0.3s;
}

.row input:focus,
.address-container textarea:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px rgba(255, 195, 0, 0.2);
    outline: none;
}

.address-container textarea {
    width: 100%;
    resize: vertical;
    margin-bottom: 20px;
}

/* Radio Button Group */
.radio-group {
    display: flex;
    gap: 30px;
    align-items: center;
    margin-bottom: 20px;
}

.radio-group label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
    font-size: 1rem;
}

.radio-group input[type="radio"] {
    margin-right: 8px;
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 50%;
    transition: border-color 0.3s;
    cursor: pointer;
}

.radio-group input[type="radio"]:checked {
    border-color: var(--accent-color);
    border-width: 5px;
}

/* Error Message */
#error {
    margin-bottom: 15px;
    min-height: 20px; /* Reserve space for the error message */
}

#addressError {
    color: var(--error-color);
    font-size: 0.9rem;
    font-weight: 500;
    text-align: center;
}

/* Action Buttons */
.actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 30px;
}

.actions button {
    padding: 12px 25px;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
    min-width: 120px;
}

.actions .save {
    background-color: var(--accent-color);
    color: var(--primary-color);
}

.actions .save:hover {
    background-color: #e6b200; /* Darker accent on hover */
}

.actions .cancel {
    background-color: var(--light-gray);
    color: var(--primary-color);
    border: 1px solid var(--border-color);
}

.actions .cancel:hover {
    background-color: #ddd;
}


/* ------------------------------------------- */
/* MEDIA QUERIES (RESPONSIVE)      */
/* ------------------------------------------- */

@media (max-width: 850px) {
    /* Header adjustments */
    nav ul {
        justify-content: flex-start;
        overflow-x: auto;
        white-space: nowrap;
    }
    nav ul li a {
        padding: 15px 15px;
    }

    /* Footer adjustments */
    footer {
        justify-content: space-around;
        padding: 40px 5%;
    }

    footer > div {
        min-width: 45%;
    }
}

@media (max-width: 768px) {
    /* Main Content adjustments */
    .row {
        flex-direction: column;
        gap: 0;
    }

    .row input {
        margin-bottom: 20px;
    }

    .address-container {
        padding: 25px;
    }
    
    .actions {
        justify-content: center;
        flex-wrap: wrap;
    }
}

@media (max-width: 500px) {
    /* Header adjustments */
    .header-top {
        flex-direction: column;
        gap: 10px;
    }
    .top-bar {
        flex-direction: column;
        gap: 5px;
        text-align: center;
    }
    .top-bar .info {
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .top-bar .info:last-child {
        border-bottom: none;
    }

    /* Footer adjustments */
    footer {
        flex-direction: column;
        gap: 30px;
        padding: 30px 5%;
    }
    footer > div {
        min-width: 100%;
        margin-right: 0;
    }
}
    </style>
  </head>

  <body>
    

    <main>
      <div class="address-container">
        <h3>Add a New Address</h3>

        <form onsubmit="submitAddress(event)">
          <div class="row">
            <input type="hidden" name="userId" id="userId" value="{{userId}}" />
            <input
              type="text"
              placeholder="Enter your name"
              id="name"
              name="name"
            />
            <input
              type="text"
              placeholder="Enter your Mobile number"
              id="phone"
              name="phone"
            />
          </div>

          <div class="row">
            <input
              type="text"
              placeholder="Enter your pincode"
              name="pincode"
              id="pincode"
            />
            <input
              type="text"
              placeholder="Enter your locality"
              name="locality"
              id="locality"
            />
          </div>

          <textarea
            placeholder="Address (House number, Area, City,Post)"
            rows="3"
            name="address"
            id="address"
          ></textarea>

          <div class="row">
            <input
              type="text"
              placeholder="City/District/Town"
              name="cityOrTown"
              id="cityOrTown"
            />
            <input
              type="text"
              placeholder="Enter your State"
              name="state"
              id="state" disabled
            />
            
          </div>

          <div class="row">
            <input
              type="text"
              placeholder="Landmark (optional)"
              name="landmark"
              id="landmark"
            />
            <input
              type="text"
              placeholder="Alternate Mobile number (optional)"
              name="altPhone"
              id="altPhone"
            />
          </div>

         

          <div class="row radio-group">
            <label
              ><input type="radio" name="addressType" value="home" /> Home</label
            >
            <label
              ><input type="radio" name="addressType" value="work" /> Work</label
            >
          </div>
           <div id="error">
            <p id="addressError"></p>
          </div>

          <div class="actions">
            <button type="submit" class="save">Save</button>
            <button
              type="button"
              class="cancel"
              onclick="window.location.href='/manageAddress'"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </main>


 

  <script>
    
    document.getElementById('pincode').addEventListener('blur', handlePincodeBlur);

    async function handlePincodeBlur(event) {
      console.log("reached handlePincodeBlur")
      const pincode = document.getElementById("pincode").value.trim()
      console.log("Blur triggered for pincode:", pincode);
      if (!pincode) return;

      try {
        const addressDetails = await getAddressDetails(pincode);
        

        if (addressDetails) {
          document.getElementById("cityOrTown").value = addressDetails.district || "";
          document.getElementById("state").value = addressDetails.state || "";
          document.getElementById("locality").value = addressDetails.locality || "";
        } else {
          alert("Invalid pincode or could not fetch details");
        }
      } catch (err) {
        console.error(err);
        alert("Error verifying pincode");
      }
    }
     
    async function getAddressDetails(pincode){
      try{

        const res=await fetch(`/verifyPincode/${pincode}`)
        const data=await res.json()
        if(res.ok){
          return data
        }else{
          console.log("Error in getAddressDetails")
        }


      }catch(err){
        console.error(err);
        
      }
    }


    async function submitAddress(event) {
      event.preventDefault();
      const id = document.getElementById("userId").value;


      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const pincode = document.getElementById("pincode").value.trim();
      const locality = document.getElementById("locality").value.trim();
      const address = document.getElementById("address").value.trim();
      const cityOrTown = document.getElementById("cityOrTown").value.trim();
      const selectedState = document.getElementById("state").value.trim();
      const addressTypeInput = document.querySelector(
        "input[name=addressType]:checked"
      );
      const addressType = addressTypeInput ? addressTypeInput.value : null;

      const landmark = document.getElementById("landmark").value.trim();
      const altPhone = document.getElementById("altPhone").value.trim();

      const errorElement = document.getElementById("addressError");
      errorElement.textContent = "";

      if (
        !name ||
        !phone ||
        !pincode ||
        !address ||
        !selectedState ||
        !addressType ||
        !locality ||
        !cityOrTown
        
      ) {
        errorElement.textContent = "Please fill all the fields";
        return;
      } else {
        errorElement.textContent = "";
      }
      if (!/^\d{6}$/.test(pincode)) {
        errorElement.textContent = "Enter a valid 6-digit pincode";
        return;
      }
      if (!/^\d{10}$/.test(phone)) {
        errorElement.textContent = "Enter a valid 10-digit phone number";
        return;
      }
      if (address.length < 10) {
        errorElement.textContent = "Enter atleast 10 charecters in address";
        return;
      }
      if (altPhone) {
        if (!/^\d{10}$/.test(altPhone)) {
          errorElement.textContent = "Enter a valid 10-digit phone number";
          return;
        }
      }

      const res = await fetch(`/addAddress/${id}`, {
        method: "POST",
        headers: { "Content-type": "application/json" },
        body: JSON.stringify({
          name,
          phone,
          pincode,
          locality,
          address,
          cityOrTown,
          state: selectedState,
          addressType,
          landmark,
          altPhone,
        }),
      });
      const data = await res.json();
      let timerInterval;
      await Swal.fire({
        title: "Alert!",
        html: data.message,
        timer: 1500,

        willClose: () => {
          clearInterval(timerInterval);
        },
      }).then((result) => {
        if (result.dismiss === Swal.DismissReason.timer) {
          console.log("I was closed by the timer");
        }
      });

      if (res.ok) {
       window.location.href = '/manageAddress';
      }
    }
  </script>

  </body>

