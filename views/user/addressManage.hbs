
<head>
  <style>
    /* Container */
.container {
  display: flex;
  gap: 24px;
  padding: 24px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  min-height: 10vh;
}

/* Main Address Section */
.address-section {
  flex: 1;
  padding: 40px;
  background: #ffffff;
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
  animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  position: relative;
  overflow: hidden;
}

.address-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background-size: 200% 100%;
}



@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Header Section */
.address-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  padding-bottom: 20px;
  border-bottom: 2px solid #f0f3f7;
  animation: slideDown 0.6s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.address-header h1 {
  font-size: 32px;
  font-weight: 700;
  background: linear-gradient(135deg, #233c79, #673ab7);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0;
}

.address-header h1::before {
  content: 'üìç';
  -webkit-text-fill-color: initial;
  font-size: 36px;
}

/* Add Address Button */
.add-address-btn {
  padding: 14px 28px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

.add-address-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.add-address-btn:hover::after {
  width: 300px;
  height: 300px;
}

.add-address-btn:hover {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
  transform: translateY(-2px);
}

.add-address-btn:active {
  transform: translateY(0);
}

/* Address List */
.address-list {
  margin-top: 24px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 24px;
  animation: fadeIn 0.8s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Address Cards */
.address-card {
  background: #ffffff;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  border: 2px solid #f0f3f7;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.address-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.3s ease;
}

.address-card:hover::before {
  transform: scaleX(1);
}

.address-card:hover {
  border-color: #233c79;
  box-shadow: 0 8px 24px rgba(35, 60, 121, 0.15);
  transform: translateY(-4px);
}

/* Card Content */
.address-card p {
  margin: 8px 0;
  font-size: 14px;
  color: #4b5563;
  line-height: 1.6;
}

.address-card p strong {
  font-size: 16px;
  color: #1a1a1a;
  font-weight: 700;
  display: block;
  margin-bottom: 4px;
}

/* Address Type Badge */
.addressType {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin: 12px 0 8px 0;
}

.addressType[style*="color:#26b708"] {
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  color: #065f46 !important;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
}

.addressType[style*="color:#26b708"]::before {
  content: 'üè† ';
}

.addressType[style*="color:red"] {
  background: linear-gradient(135deg, #fee2e2, #fecaca);
  color: #991b1b !important;
  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
}

.addressType[style*="color:red"]::before {
  content: 'üíº ';
}

/* Address Actions */
.address-actions {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px dashed #e5e7eb;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}

.address-actions .editButton,
.address-actions .deleteButton {
  flex: 1;
  min-width: 100px;
  padding: 10px 18px;
  border: none;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

.address-actions .editButton::before,
.address-actions .deleteButton::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.4s, height 0.4s;
}

.address-actions .editButton {
  background: linear-gradient(135deg, #233c79 0%, #1a2c58 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(35, 60, 121, 0.3);
}

.address-actions .editButton::before {
  background: rgba(255, 255, 255, 0.2);
}

.address-actions .editButton:hover::before {
  width: 200px;
  height: 200px;
}

.address-actions .editButton:hover {
  background: linear-gradient(135deg, #1a2c58 0%, #0f1a35 100%);
  box-shadow: 0 6px 20px rgba(35, 60, 121, 0.4);
  transform: translateY(-2px);
}

.address-actions .deleteButton {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.address-actions .deleteButton::before {
  background: rgba(255, 255, 255, 0.2);
}

.address-actions .deleteButton:hover::before {
  width: 200px;
  height: 200px;
}

.address-actions .deleteButton:hover {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
  transform: translateY(-2px);
}

.address-actions button:active {
  transform: translateY(0);
}

/* Empty State */
.address-section > p {
  text-align: center;
  padding: 80px 20px;
  font-size: 16px;
  font-weight: 500;
  color: #6b7280;
  background: linear-gradient(135deg, #f9fafb, #f3f4f6);
  border-radius: 16px;
  margin-top: 24px;
  border: 2px dashed #d1d5db;
}

.address-section > p::before {
  content: 'üì¶';
  display: block;
  font-size: 64px;
  margin-bottom: 16px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

/* ===== MODAL STYLES (KEPT ORIGINAL) ===== */

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
  transition: opacity 0.3s ease;
}

.modal-content {
  background-color: #ffffff;
  margin: 0% auto;
  padding: 30px 35px;
  border-radius: 16px;
  width: 520px;
  max-width: 95%;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  animation: fadeInModal 0.3s ease, slideUp 0.3s ease;
  position: relative;
}

@keyframes fadeInModal {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(20px); }
  to { transform: translateY(0); }
}

.close {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #888;
  cursor: pointer;
  transition: color 0.2s ease;
}

.close:hover {
  color: #000;
}

.modal-content h3 {
  margin-bottom: 20px;
  font-size: 20px;
  color: #000000;
  text-align: center;
}

form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.row {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.row input,
.row select,
textarea {
  flex: 1;
  padding: 12px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background: #fafafa;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.row input:focus,
.row select:focus,
textarea:focus {
  border-color: #203acd;
  box-shadow: 0 0 0 2px rgba(32, 58, 205, 0.1);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 70px;
}

.radio-group {
  display: flex;
  justify-content: start;
  gap: 20px;
  margin-top: 5px;
  font-size: 14px;
  position: sticky;
  bottom: 0;
}

.actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  background: #fff;
  padding-top: 15px;
  position: sticky;
  bottom: 0;
}

button.save {
  background: #110ae9;
  color: white;
  border: none;
  padding: 10px 22px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  transition: background 0.2s ease;
}

button.save:hover {
  background: #1a2fb1;
}

button.cancel {
  background: #e0e0e0;
  color: #333;
  padding: 10px 22px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s ease;
}

button.cancel:hover {
  background: #cfcfcf;
  color: #ff0000;
}

#error {
  margin-top: -10px;
}

/* Delete Modal */
#deleteModal .modal-content {
  max-height: 100%;
  overflow-y: auto;
  background-color: #ffffff;
  margin: 10% auto;
  padding: 30px 35px;
  border-radius: 16px;
  width: 400px;
  max-width: 95%;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  animation: fadeInModal 0.3s ease, slideUp 0.3s ease;
  position: relative;
  text-align: center;
}

#deleteModal .modal-content h3 {
  font-size: 18px;
  color: #d1001f;
  margin-bottom: 10px;
}

#deleteModal .modal-content p {
  font-size: 14px;
  color: #555;
  margin-bottom: 20px;
}

#deleteModal .actions {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 10px;
  padding-top: 10px;
}

#deleteModal .save {
  background: #d1001f;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s ease;
}

#deleteModal .save:hover {
  background: #a0001a;
}

#deleteModal .cancel {
  background: #e0e0e0;
  color: #333;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s ease;
}

#deleteModal .cancel:hover {
  background: #cfcfcf;
  color: #ff0000;
}

#deleteModal .warning-icon {
  font-size: 40px;
  color: #d1001f;
  margin-bottom: 15px;
  text-align: center;
}

/* ===== RESPONSIVE STYLES (FIXED) ===== */

@media (max-width: 1024px) {
  .address-list {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }
}

@media (max-width: 768px) {
  .container {
    flex-direction: column;
    /* Reduce overall container padding for more screen space */
    padding: 10px; 
  }

  .address-section {
    /* Significantly reduce top padding to minimize the gap */
    padding: 20px 20px 28px 20px; 
  }

  .address-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .address-header h1 {
    font-size: 26px;
  }

  .address-header h1::before {
    font-size: 30px;
  }

  .add-address-btn {
    width: 100%;
  }

  .address-list {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .address-card {
    padding: 20px;
  }

  .address-actions {
    flex-direction: column;
  }

  .address-actions .editButton,
  .address-actions .deleteButton {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .address-section {
    /* Further reduce top padding for very small screens */
    padding: 15px 16px 20px 16px;
  }

  .address-header h1 {
    font-size: 22px;
  }

  .address-header h1::before {
    font-size: 26px;
  }

  .add-address-btn {
    padding: 12px 20px;
    font-size: 13px;
  }

  .address-card {
    padding: 18px;
  }

  .address-card p {
    font-size: 13px;
  }
}

/* ===== ACCESSIBILITY ===== */

button:focus-visible {
  outline: 3px solid #233c79;
  outline-offset: 2px;
}
  </style>
</head>

 
    <div class="container">
      {{> user/sidebar }} 

      <div class="address-section">
        <div class="address-header">
          <h1>Manage Addresses</h1>
          {{!-- <button class="add-address-btn" onclick=openAddModal(event,'{{userId}}')>+ Add New Address</button> --}}
          <button class="add-address-btn" onclick=addAddress(event)>+ Add New Address</button>
        </div>

       {{#if addresses.length}}
          <div class="address-list">
            {{#each addresses}}
              <div class="address-card">
                <p><strong>{{this.name}}</strong></p>
                <p>{{this.address}}</p>
                {{#if this.landMark}}
                <p>{{this.landMark}},</p>
                {{/if}}
                <p>{{this.city}},{{this.state}} - {{this.pincode}}</p>
                <p>Phone: {{this.phone}}</p>
                {{#if this.altPhone}}
                <p>Alternative Phone: {{this.altPhone}}</p>
                {{/if}}
                <div class="address-actions">
                    <p class="addressType" style="color:{{#if (eq this.addressType 'home')}}#26b708{{else}}red{{/if}} ">{{#if (eq this.addressType 'home') }}HOME{{else}}WORK{{/if}}</p>
                    <button class="editButton" onclick="openEditModal(event,'{{this._id}}')">Edit</button>
                    <button class="deleteButton" onclick=deleteAddress('{{this._id}}')>Delete</button>
                </div>
              </div>
            {{/each}}
          </div>
        {{else}}
          <p>No addresses found. Please add one.</p>
        {{/if}}
      </div>
    </div>


<!-- Edit Address Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeEditModal()">&times;</span>
    <h3>Add a new address</h3>
     <form onsubmit="submitEditAddress(event)">
      <div class="row">
        <input type="hidden" id="editAddressId" />
        <input type="text" id="edit-name" name="name" placeholder="Enter your name">
        <input type="text" id="edit-phone" name="phone" placeholder="Enter your Mobile number">
      </div>
      <div class="row">
        <input type="text" name="pincode" id="edit-pincode" placeholder="Enter your pincode">
        <input type="text" name="locality" id="edit-locality" placeholder="Enter your locality">
      </div>
      <textarea rows="3" name="address" id="edit-address" placeholder="Address (Area, City,Post)"></textarea>
       <div class="row">
        <input type="text"  name="cityOrTown" id="edit-cityOrTown"  placeholder="City/District/Town">
        <input type="text" name="state" id="edit-state" placeholder="Enter your State">

      </div>


      <div class="row">
        <input type="text" placeholder="Landmark (optional)" name="landmark" id="edit-landmark">
        <input type="text" placeholder="Alternate Mobile number (optional)" name="altPhone" id="edit-altPhone">
      </div>
      <div id="error">
        <p id="editAddressError" style="color: red;"></p>
      </div>
      <div class="row radio-group">
        <label><input type="radio" name="editAddressType" value="home"> Home</label>
        <label><input type="radio" name="editAddressType" value="work"> Work</label>
      </div>
      <div class="actions">
        <button type="submit" class="save">Save</button>
        <button type="button" class="cancel" onclick="closeEditModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>




<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">

    <span class="close" onclick="closeDeleteModal()">&times;</span>
    
    <div class="warning-icon">
      ‚ö†Ô∏è
    </div>
  
    <h3>Are you sure you want to delete this address?</h3>
    <p>This action cannot be undone.</p>
    <input type="hidden" id="deleteAddress" />

    <div class="actions">
      <button class="save" onclick="confirmDeleteAddress()">Yes, Delete</button>
      <button class="cancel" onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>
</div>




<script>


    //delete Modal
function deleteAddress(id) {
  document.getElementById("deleteModal").style.display = "block";
  document.getElementById("deleteAddress").value = id;
}

async function confirmDeleteAddress() {
  const id = document.getElementById("deleteAddress").value;
  const res = await fetch(`/deleteAddress/${id}`, {
    method: "DELETE",
    headers: { "Content-type": "application/json" },
  });

  const data = await res.json();
  let timerInterval;
  await Swal.fire({
    title: "Done!",
    html: data.message,
    timer: 1500,

    willClose: () => {
      clearInterval(timerInterval);
    },
  }).then((result) => {
    if (result.dismiss === Swal.DismissReason.timer) {
      console.log("I was closed by the timer");
    }
  });

  if (res.ok) {
    closeDeleteModal();
    window.location.reload();
  }
}


async function handlePincodeBlur(event) {
  console.log("reached handlePincodeBlur")
  const pincode = document.getElementById("pincode").value.trim()
  console.log("Blur triggered for pincode:", pincode);
  if (!pincode) return;

  try {
    const addressDetails = await getAddressDetails(pincode);

    if (addressDetails) {
      document.getElementById("cityOrTown").value = addressDetails.district || "";
      document.getElementById("state").value = addressDetails.state || "";
      document.getElementById("post").value = addressDetails.post || "";
    } else {
      alert("Invalid pincode or could not fetch details");
    }
  } catch (err) {
    console.error(err);
    alert("Error verifying pincode");
  }
}


async function submitAddress(event) {
  event.preventDefault();
  const id = document.getElementById("addressModal").dataset.userId;

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const pincode = document.getElementById("pincode").value.trim();
  const locality = document.getElementById("locality").value.trim();
  const address = document.getElementById("address").value.trim();
  const cityOrTown = document.getElementById("cityOrTown").value.trim();
  const selectedState = document.getElementById("state").value.trim();
  const post=document.getElementById("post").value.trim()
  const addressTypeInput = document.querySelector(
    "input[name=addressType]:checked"
  );
  const addressType = addressTypeInput ? addressTypeInput.value : null;

  const landmark = document.getElementById("landmark").value.trim();
  const altPhone = document.getElementById("altPhone").value.trim();

  const errorElement = document.getElementById("addressError");
  errorElement.textContent = "";

  if (
    !name ||
    !phone ||
    !pincode ||
    !address ||
    !selectedState ||
    !addressType ||
    !locality ||
    !cityOrTown||
    !post
  ) {
    errorElement.textContent = "Please fill all the fields";
    return;
  } else {
    errorElement.textContent = "";
  }
  if (!/^\d{6}$/.test(pincode)) {
    errorElement.textContent = "Enter a valid 6-digit pincode";
    return;
  }
  if (!/^\d{10}$/.test(phone)) {
    errorElement.textContent = "Enter a valid 10-digit phone number";
    return;
  }
  if (address.length < 10) {
    errorElement.textContent = "Enter atleast 10 charecters in address";
    return;
  }
  if (altPhone) {
    if (!/^\d{10}$/.test(altPhone)) {
      errorElement.textContent = "Enter a valid 10-digit phone number";
      return;
    }
  }

  const res = await fetch(`/addAddress/${id}`, {
    method: "POST",
    headers: { "Content-type": "application/json" },
    body: JSON.stringify({
      name,
      phone,
      pincode,
      locality,
      address,
      cityOrTown,
      state: selectedState,
      addressType,
      landmark,
      altPhone,
      post,
    }),
  });
  const data = await res.json();
  let timerInterval;
  await Swal.fire({
    title: "Alert!",
    html: data.message,
    timer: 1500,

    willClose: () => {
      clearInterval(timerInterval);
    },
  }).then((result) => {
    if (result.dismiss === Swal.DismissReason.timer) {
      console.log("I was closed by the timer");
    }
  });

  if (res.ok) {
    closeModal();
    window.location.reload();
  }
}

//edit modal
async function openEditModal(event, id) {
  document.getElementById("editModal").style.display = "block";
  document.getElementById("editModal").dataset.address = id;
  const errorElement = document.getElementById("editAddressError");
  errorElement.textContent = "";

  const res = await fetch(`/editAddress/${id}`);

  const data = await res.json();
  console.log(data);
  document.getElementById("edit-name").value = data.name || "";
  document.getElementById("edit-phone").value = data.phone || "";
  document.getElementById("edit-pincode").value = data.pincode || "";
  document.getElementById("edit-locality").value = data.locality || "";
  document.getElementById("edit-address").value = data.address || "";
  document.getElementById("edit-cityOrTown").value = data.city || "";
  document.getElementById("edit-state").value = data.state || "";
  const addressTypeRadio = document.querySelector(
    `input[name=editAddressType][value="${data.addressType}"]`
  );
  if (addressTypeRadio) {
    addressTypeRadio.checked = true;
  }

  document.getElementById("edit-landmark").value = data.landMark || "";
  document.getElementById("edit-altPhone").value = data.altPhone || "";
}

async function submitEditAddress(event) {
  event.preventDefault();
  const id = document.getElementById("editModal").dataset.address;

  const name = document.getElementById("edit-name").value.trim();
  const phone = document.getElementById("edit-phone").value.trim();
  const pincode = document.getElementById("edit-pincode").value.trim();
  const locality = document.getElementById("edit-locality").value.trim();
  const address = document.getElementById("edit-address").value.trim();
  const city = document.getElementById("edit-cityOrTown").value.trim();
  const state = document.getElementById("edit-state").value.trim();
  const addressTypeInput = document.querySelector(
    "input[name=editAddressType]:checked"
  );
  const addressType = addressTypeInput ? addressTypeInput.value : null;

  const landMark = document.getElementById("edit-landmark").value.trim();
  const altPhone = document.getElementById("edit-altPhone").value.trim();

  const errorElement = document.getElementById("editAddressError");
  errorElement.textContent = "";
  console.log(name);
  if (
    !name ||
    !phone ||
    !pincode ||
    !address ||
    !state ||
    !addressType ||
    !locality ||
    !city
  ) {
    errorElement.textContent = "Please fill all the fields";
    return;
  } else {
    errorElement.textContent = "";
  }

  if (!/^\d{6}$/.test(pincode)) {
    errorElement.textContent = "Enter a valid 6-digit pincode";
    return;
  }
  if (!/^\d{10}$/.test(phone)) {
    errorElement.textContent = "Enter a valid 10-digit phone number";
    return;
  }
  if (address.length < 10) {
    errorElement.textContent = "Enter atleast 10 charecters in address";
    return;
  }
  if (altPhone) {
    if (!/^\d{10}$/.test(altPhone)) {
      errorElement.textContent = "Enter a valid 10-digit phone number";
      return;
    }
  }

  const res = await fetch(`/submitEditAddress/${id}`, {
    method: "PUT",
    headers: { "Content-type": "application/json" },
    body: JSON.stringify({
      name,
      phone,
      pincode,
      locality,
      address,
      city,
      state,
      addressType,
      landMark,
      altPhone,
    }),
  });

  const data = await res.json();
  let timerInterval;
  await Swal.fire({
    title: "Alert!",
    html: data.message,
    timer: 1500,

    willClose: () => {
      clearInterval(timerInterval);
    },
  }).then((result) => {
    if (result.dismiss === Swal.DismissReason.timer) {
      console.log("I was closed by the timer");
    }
  });

  if (res.ok) {
    closeEditModal();
    window.location.reload();
  }
}

//closing modals

function closeEditModal() {
  const modal = document.getElementById("editModal");
  modal.style.display = "none";
}

function closeModal() {
  const modal = document.getElementById("addressModal");
  modal.style.display = "none";
  modal.dataset.userId = "";

  // Clear fields
  modal.querySelectorAll("input, textarea").forEach((el) => (el.value = ""));
  modal.querySelectorAll('input[name="addressType"]').forEach((el) => (el.checked = false));
  document.getElementById("addressError").textContent = "";


  const pincodeInput = document.getElementById("pincode");
  if (pincodeInput && pincodeInput.dataset.listenerAdded) {
    pincodeInput.removeEventListener("blur", handlePincodeBlur);
    delete pincodeInput.dataset.listenerAdded;
  }
}

function closeDeleteModal() {
  const modal = document.getElementById("deleteModal");
  modal.style.display = "none";
}

window.onclick = function (event) {
  const addressModal = document.getElementById("addressModal");
  const editModal = document.getElementById("editModal");
  const deleteModal = document.getElementById("deleteModal");

  {{!-- if (event.target === addressModal) closeModal();
  if (event.target === editModal) closeEditModal(); --}}
  if (event.target === deleteModal) closeDeleteModal();
};




   
 async function getAddressDetails(pincode){
  try{

    const res=await fetch(`/verifyPincode/${pincode}`)
    const data=await res.json()
    if(res.ok){
      return data
    }else{
      console.log("Error in getAddressDetails")
    }


  }catch(err){
    console.error(err);
     
  }
 }

 async function addAddress(event){
  event.preventDefault()
  window.location.href = "/addAddress";
 }


</script>