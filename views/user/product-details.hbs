<head>
    

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
    rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/home.css" type="text/css">
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easyzoom@2.5.0/css/easyzoom.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }

        .product-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .product-details {
            flex: 1;
            min-width: 300px;
        }

        .product-title {
            color: black;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .product-description {
            font-size: 1rem;
            color: #555;
            margin-bottom: 15px;
        }

        .product-price {
            font-size: 1.2rem;
            color: #e91e63;
            margin-bottom: 15px;
        }

      .size-selection {
        margin: 1rem 0;
        font-family: Arial, sans-serif;
        }

        .size-selection label {
        display: block;
        font-weight: bold;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
        color: #333;
        }

        .size-options {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        }

        .size-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        }

        .size-option button {
        padding: 8px 14px;
        border: 2px solid #333;
        border-radius: 6px;
        background-color: white;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s ease;
        }
        .size-btn.selected {
        background-color: #333;
        color: #fff;
        border: 2px solid #000;
        }

        .size-option button:hover:not(:disabled) {
        background-color: #333;
        color: #fff;
        }

        .size-option button:disabled {
        border-color: #aaa;
        background-color: #f2f2f2;
        color: #888;
        cursor: not-allowed;
        }

        .size-option small {
        margin-top: 4px;
        font-size: 12px;
        color: #28a745; /* green for stock */
        }

        .size-option button:disabled + small {
        display: none; /* hide stock info if disabled */
        }


        .add-to-cart {
            background-color: #ff9800;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            max-width: 200px;
        }

        .add-to-cart:hover {
            background-color: #e68900;
        }

        .product-info {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #333;
        }

        .product-info h3 {
            margin-bottom: 10px;
        }

        .product-info ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 10px;
            }

            .product-image, .product-details {
                min-width: 100%;
            }

            .product-title {
                color: black;
                font-size: 1.2rem;
            }

            .product-description {
                font-size: 0.9rem;
            }

            .product-price {
                font-size: 1rem;
            }

            .add-to-cart {
                max-width: 100%;
            }
        }
        .easyzoom {
        position: relative;
        display: inline-block;
        }
        .easyzoom img {
        display: block;
        }
        .easyzoom-flyout {
        position: absolute;
        z-index: 100;
        overflow: hidden;
        border: 1px solid #ccc;
        background: #fff;
        }

     
        
    </style>
</head>

<div class="container">

  <div class="easyzoom easyzoom--overlay" id="main-easyzoom">
    <a id="main-easyzoom-link" href="/images/{{product.productImages.[0]}}">
      <img id="main-product-image" style="height: 25rem; width:28rem" src="/images/{{product.productImages.[0]}}"
        alt="Zoomed Product Image" />
    </a>
    <div class="product-thumbnails" style="margin-top: 1rem; display: flex; gap: 10px;">
      {{#each product.productImages}}
      <img class="product-thumbnail" data-image="/images/{{this}}" src="/images/{{this}}"
        style="width: 60px; height: 60px; object-fit: cover; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;"
        alt="Product Thumbnail" />
      {{/each}}
    </div>
  </div>
  <!-- Thumbnails of product-->



  <div class="product-details">
    <h1 class="product-title">{{product.productName}}</h1>
    {{#if (gt product.appliedOffer 0)}}
      <p style="color: red; font-weight:900; font-size:large">{{product.appliedOffer}}% off</p> 
    {{/if}}
    <p class="product-price">&#x20b9;{{product.salePrice}}
      <span style="text-decoration: line-through; color: #888;">
        &#x20b9;{{product.regularPrice}}
      </span>
    </p>

    <div class="size-selection">
      <label for="size">Select Size</label>
      <div class="size-options">
        {{#each product.allVariants}}
        
        <div class="size-option">
            <button type="button" value="{{@key}}" class="size-btn" {{#if (eq this 0)}}disabled{{/if}}>
            {{@key}}
            </button>
          
            {{#if (gt this 0)}}
              {{#if (lt this 6)}}
                <small style="color: red;">Hurry! Only {{this}} left</small>
            {{else}}
              <small>{{this}} in stock</small>
              {{/if}}
            {{/if}}
          
        </div>
        {{/each}}
      </div>
      
    </div>

    {{#if (eq isOutOfStock false)}}

    <div>
      <button class="add-to-cart" onclick="addToCart(event,'{{product._id}}')">Add to Cart</button>
      <button class="add-to-cart" onclick="buyItNow(event,'{{product._id}}')">Buy it Now</button>

    </div>
    <p id="error" style="color: red;"></p>
    {{else}}
    <p style="color: red;">Out of of stock</p>

    {{/if}}
    {{!-- {{/if}} --}}
    <div class="product-info">
      <h3 style="color: black;">About this item</h3>
      <p>{{product.description}}</p>
    </div>
  </div>
</div>


<section class="product spad">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">

        <ul class="filter__controls">


          <li data-filter=".new-arrivals">Your Choices</li>

        </ul>
      </div>
    </div>
    <div class="row product__filter">
      {{#each products}}
      <div class="col-lg-3 col-md-6 col-sm-6 mix new-arrivals">
        <div class="product__item">
          <a href="/productDetails?id={{this._id}}">
            <div class="product__item__pic set-bg" data-setbg="/images/{{this.productImages.[0]}}">
              {{!-- <span class="label">New</span> --}}
              <ul class="product__hover">
                {{!-- <li><button onclick="addWishlist(event,'{{this._id}}')"><img src="img/icon/heart.png" alt=""></button>
                </li>--}}
              </ul>
            </div>
          </a>
          <div class="product__item__text">
            <h6>{{this.productName}}</h6>
           
            {{#if (includes ../wishlistProducts this._id)}}
                <a id="wishlist-{{this._id}}" class="add-cart">❤️ Wishlisted</a>
                {{else}}
                <a href="#" id="wishlist-{{this._id}}" onclick="addWishlist(event,'{{this._id}}')" class="add-cart">+ Add to Wish
                    list</a>
            {{/if}}
            {{!-- <div class="rating">
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
            </div> --}}
            {{#if (gt this.appliedOffer 0)}}
              <p style="color: red; font-weight:900; font-size:large">{{this.appliedOffer}}% off</p> 
            {{/if}}
            <h5>&#x20b9;{{this.salePrice}} <span
                style="text-decoration: line-through; color: #888;">&#x20b9;{{this.regularPrice}}</span> </h5>
          </div>
        </div>
      </div>
      {{/each}}


    </div>
  </div>
</section>



<script src="/js/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/easyzoom@2.5.0/dist/easyzoom.js"></script>

<script>
let selectedSize;
document.querySelectorAll(".size-btn").forEach(btn => {
  btn.addEventListener("click", (e) => {
    document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("selected"));
    e.target.classList.add("selected");
    
  });
});

  $(document).ready(function () {
    $('.set-bg').each(function () {
      const bg = $(this).data('setbg');
      if (bg) {
        $(this).css('background-image', 'url(' + bg + ')');
      }
    });
    // Only initialize EasyZoom if the plugin loaded
    var easyzoomApi = null;
    if ($.fn.easyZoom) {
      easyzoomApi = $('#main-easyzoom').easyZoom().data('easyZoom');
    } else {
      console.error('EasyZoom plugin not loaded!');
    }
    // Thumbnail click handler
    $('.product-thumbnail').on('click', function() {
      var newImage = $(this).data('image');
      $('#main-product-image').attr('src', newImage);
      $('#main-easyzoom-link').attr('href', newImage);
      // Swap EasyZoom image
      if (easyzoomApi) {
        easyzoomApi.swap(newImage, newImage);
      }
    });
  });
  
//if cart is empty
async function addToCart(event, id) {

event.preventDefault();
document.getElementById("error").innerText=""
const selectedBtn = document.querySelector(".size-btn.selected");

if (!selectedBtn) {
    document.getElementById("error").innerText="Please select a size before adding to cart."
    return;
  }

const size=selectedBtn.value

  const res = await fetch(`/addToCart/${id}`, {
    method:"POST",
    headers: {
      "Content-Type": "application/json",
    },
    body:JSON.stringify({size})
  });

  
  const data = await res.json();

  if (res.ok) {
    Toastify({
        text: data.message,
        duration: 3000,
        close: true,          
        gravity: "top",       
        position: "center",    
        style: {
            background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)", 
        },
        className: "custom-toast", 
        
        }).showToast();


        
    
  } else {
    console.error("Failed to add item:", data.message || "Unknown error");
  }
}
//linear-gradient(to right,  #1e3c72, #6dd5ed)

async function addWishlist(event,id){
    event.preventDefault();
    console.log('addWishlist loaded with id   :::::::',id)
    const res=await fetch(`/addWishlist/${id}`,{
        method:"POST",
        headers:{"Content-type":"application/json"}
    })

    const data=await res.json()


    if(res.ok){
        Toastify({
            text: "Added to wishlist",
            duration: 3000,
            close: true,          
            gravity: "top",
            position: "center",    
            style: {
                background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)", 
            },
            className: "custom-toast", 
            onClick: () => {     
                alert("Toast clicked!");
        }
        }).showToast();
        document.getElementById(`wishlist-${id}`).innerHTML="❤️ Wishlisted"
        wishlistBtn.onclick = null;
        wishlistBtn.removeAttribute("onclick");
        wishlistBtn.style.pointerEvents = "none";

    }
}

     
async function buyItNow(event,id){
    event.preventDefault()

    const selectedBtnEl = document.querySelector(".size-btn.selected");
    const selectedBtn = selectedBtnEl ? selectedBtnEl.value : null;
    

    if (!selectedBtn) {
        document.getElementById("error").innerText="Please select a size before check out."
        return;
      }
    const size=selectedBtn
    window.location.href = `/loadAddressForOrder/${id}?size=${size}`;
}

//beauty
async function addToCartBeauty(event, id) {

event.preventDefault();
const beauty=true
  const res = await fetch(`/addToCart/${id}`, {
    method:"POST",
    headers: {
      "Content-Type": "application/json",
    },
    body:JSON.stringify({beauty})
  });

  
  const data = await res.json();

  if (res.ok) {
    Toastify({
        text: data.message,
        duration: 3000,
        close: true,          
        gravity: "top",       
        position: "center",    
        style: {
            background: "linear-gradient(to right, #0f2027, #203a43, #2c5364)", 
        },
        className: "custom-toast", 
        
        }).showToast();


        
    
  } else {
    console.error("Failed to add item:", data.message || "Unknown error");
  }
}

async function buyItNowBeauty(event,id){
    event.preventDefault()

    window.location.href = `/loadAddressForOrder/${id}`;
}

</script>